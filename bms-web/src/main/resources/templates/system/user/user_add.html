<div class="container row" style="margin-top: 18px;width: 100%;">
    <div class="form-unit">基本信息</div>
    <form class="form-horizontal" id="addUserForm">
        <input type="hidden" name="id" th:if="${user}!=null" th:value="${user}==null?'':${user.id}">
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">坐席工号<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" id="user_loginName" name="loginName"
                               th:value="${user}==null?'':${user.loginName}">
                    </div>
                </div>
            </div>
            <div class="col-md-4">

                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">员工姓名<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" name="realName"
                               th:value="${user}==null?'':${user.realName}">
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">分机号<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" name="channelCode"
                               th:value="${user}==null?'':${user.channelCode}">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!--<div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">登录密码<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="password" class="form-control" name="password">
                    </div>
                </div>
            </div>-->

            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">手机号码</label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" name="phone" th:value="${user}==null?'':${user.phone}">
                    </div>
                </div>
            </div>


            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">邮箱</label>
                    <div class="col-md-8 col-sm-8">
                        <input type="email" class="form-control" name="email" th:value="${user}==null?'':${user.email}">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">公司<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" id="userCompany"
                               th:value="${user}==null?'':${user.companyName}">
                        <input type="hidden" name="companyCode" th:value="${user}==null?'':${user.companyCode}">
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">部门<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" placeholder="请选择部门" id="userDept"
                               th:value="${user}==null?'':${user.deptName}">
                        <input type="hidden" name="deptCode" th:value="${user}==null?'':${user.deptCode}">
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">组</label>
                    <div class="col-md-8 col-sm-8">
                        <input type="text" class="form-control" placeholder="请选择小组" id="userGroup"
                               th:value="${user}==null?'':${user.groupName}">
                        <input type="hidden" name="groupCode" th:value="${user}==null?'':${user.groupCode}">
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-4">
                <div class="form-group form-md-radios form-sm-radios">
                    <label class="control-label col-md-4 col-sm-4">性别</label>
                    <div class="col-md-8 col-sm-8">
                        <div class="md-radio-inline">
                            <div class="md-radio">
                                <input type="radio" id="gender_man" checked="checked" name="sex"
                                       value="1" class="md-radiobtn">
                                <label for="gender_man">
                                    <span></span>
                                    <span class="check"></span>
                                    <span class="box"></span> 男 </label>
                            </div>
                            <div class="md-radio">
                                <input type="radio" id="gender_woman" name="sex" value="2"
                                       class="md-radiobtn">
                                <label for="gender_woman">
                                    <span></span>
                                    <span class="check"></span>
                                    <span class="box"></span> 女 </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4">职位<span
                            class="required">*</span></label>
                    <div class="col-md-8 col-sm-8">
                        <select class="form-control position-select" name="positionCode">
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="form-unit">授权角色</div>
</div>
<table class="table table-striped table-bordered table-hover"
       id="cpmg-user-role-table">
    <thead>
    <tr>
        <th data-field="id" data-checkbox="true" data-formatter="stateFormater"></th>
        <th data-field="roleName">角色名称</th>
        <th data-field="roleCode">角色编码</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<div class="container row form-buttons" style="width: 100%;">
    <div class="col-md-4"></div>
    <div class="col-md-4">
        <a id="addUserBtn"
           class="btn btn-circle green btn-outline sbold">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;提交&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        <a onclick="CommonUtils.reset('addUserForm')"
           class="btn btn-circle purple btn-outline sbold">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;清空&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        <a onclick="CommonUtils.closeTab('addUserTab')"
           class="btn btn-circle red btn-outline sbold">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关闭&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
    </div>
</div>

<script th:src="@{/assets/global/plugins/bootstrapvalidator/js/bootstrapValidator.min.js}"
        type="text/javascript"></script>
<script th:src="@{/assets/auth/user.js}" type="text/javascript"></script>
<script>

    function stateFormater(value, row, index) {
        if (row.state == true)
            return {
                disabled: false,//设置是否可用
                checked: true//设置选中
            };
        return value;
    }

    (function () {

        var loginName = $("#user_loginName").val();
        $("#cpmg-user-role-table").bootstrapTable({
            method: 'get',
            url: CM_Components.getContextAll("/role/query?loginName=" + loginName),
            cache: false,
            dataType: "json",
            striped: false,	 //使表格带有条纹
            sortable: true,
            pagination: true,	//在表格底部显示分页工具栏
            pageSize: 10,
            pageNumber: 1,
            pageList: [5],
            idField: "id",  //标识哪个字段为id主键
            showToggle: false,   //名片格式
            cardView: false,//设置为True时显示名片（card）布局
            singleSelect: false,//复选框只能选择一条记录
            search: false,//是否显示右上角的搜索框
            // clickToSelect: true,//点击行即可选中单选/复选框
            sidePagination: "server",//表格分页的位置
            queryParamsType: "", //参数格式,发送标准的RESTFul类型的参数请求
            strictSearch: true,
            showColumns: false,     //是否显示所有的列
            showRefresh: false,     //是否显示刷新按钮
            minimumCountColumns: 2,    //最少允许的列数
            checkbox: true,
            responseHandler: function (res) {
                return {
                    "rows": res.dataList,
                    "total": res.total
                };
            },
            formatNoMatches: function () {  //没有匹配的结果
                return '无符合条件的记录';
            }
        });


        // 职位
        var $positionSelect = $(".position-select");
        $.ajax({
            url: CM_Components.getContextAll("/position/page/list"),
            type: "get",
            success: function (result) {
                if (result && result.dataList) {
                    var dataList = result.dataList;
                    var content = "<option value=''>选择</option>";
                    $positionSelect.append(content);
                    for (var i = 0; i < dataList.length; i++) {
                        content = "<option value='" + dataList[i].positionCode + "'>" + dataList[i].positionName + "</option>";
                        $positionSelect.append(content);
                    }
                }
            },
            error: function (errorMsg) {
                console.error(errorMsg);
            }
        });
        // 职位

        CM_User.initUserAdd(/*[[@{/user}]]*/);

        $("#userCompany,#userDept,#userGroup").focus(function () {
            var domId = $(this).attr("id");
            deptCheck(domId);
        });

        var deptCheck = function (domId) {
            layer.open({
                type: 2,
                skin: "cm-custom-layer",
                title: "选择公司",
                area: ['300px', '400px'],
                fix: false, //不固定
                shadeClose: false,
                shade: 0.5,
                scrollbar: false,
                btn: ["确定", "取消"],
                content: CM_Components.getContextAll("/dep/alert/list"),
                success: function (layero, index) {
                    // layui-layer-iframe2
                    var loginPage;
                    // js获取ifram中的元素
                    loginPage = window.frames["layui-layer-iframe" + index].document.getElementById("cpmg-login");

                    // jq获取iframe中的元素
                    // loginPage=$("#layui-layer-iframe"+index).contents().find("#cpmg-login");
                    // 如果会话失效，重定向只登陆页面
                    if (loginPage) {
                        window.location = CM_Components.getContextAll("/login");
                    }
                },
                yes: function (index, layero) {
                    var dept = $(layero).find("iframe")[0].contentWindow.selectDeptCode();
                    if (!dept) {
                        CM_Components.layerMsg("请选择！");
                        return;
                    }
                    var checkDom = $("#" + domId);
                    checkDom.val(dept.depName);
                    checkDom.next().val(dept.depCode);
                    layer.close(index);
                }
            });
        }
    })();
</script>